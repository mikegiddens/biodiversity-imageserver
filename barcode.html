<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Barcode Information</title>
<style type="text/css">
<!--
.ibox {
	border: thin solid #060;
	padding: 3px;
}

a:link {
	color: #060;
}
a:visited {
	color: #060;
}
a:hover {
	color: #060;
}
a:active {
	color: #060;
}

.ibox:focus { 
  background-color:#A5DC4B; 
}
.main {
	float: left;
}
.results {
	float: right;
}
body,td,th {
	font-family: Arial, Helvetica, sans-serif;
}

-->
</style>

</head>

<body>
	<script type="text/javascript" src="resources/js/classes/soundmanager2.js"></script>  	
	<script type="text/javascript">
		soundManager.url = 'resources/sounds/'; // directory where SM2 .SWFs live
		soundManager.useFlashBlock = false;
		soundManager.onload = function() {
			soundManager.createSound({
					id: 'Beep6'
				,	url: 'resources/sounds/beep-6.mp3'
			});
		}
	</script>

	<script type="text/javascript" src="resources/ext/ext-core-debug.js"></script>
	
  <div style="margin-left: 10px;" align="center">
  	<div class="main">
    <label style="font-weight:bold;"><a href="index.php"><img src="images/biodiversity-image-server-logo.jpg" alt="Biodiveristy Image Server" width="318" height="108" border="0" /></a></label>
		<br /> 
    <hr size="1" noshade="noshade" />
    <br />
    Barcode: <input name="barcode" type="text" class="ibox" id="barcode" size="40px" />
    </div>
    <div class="results" id="tplID"></div>
  </div>
  <script>
	Ext.onReady(function(){
											 
		function process(e, el) {
				if(e.keyCode == 13){
					var bcValue = el.value;
					el.value = "";
					if (Ext.isEmpty(bcValue)){
						Ext.Msg.alert("Notice", "Please enter barcode.");
					} else {
						Ext.get("tplID").update("<img src=\"resources/images/loading.gif\" alt=\"Loading...\">");
						Ext.Ajax.request({
							scope: this
						,	url: 'resources/api/api.php'
						,	params: {
									cmd : 'images'
								,	'filter[0][data][type]': 'string'
								,	'filter[0][data][value]': bcValue
								,	'filter[0][field]': 'barcode'
							}
						,	success: function(response){
								var data = Ext.decode(response.responseText);
								if(Ext.isEmpty(data.data)){
									soundManager.play('Beep6');
									var t = new Ext.Template(
										'<p align="center">{barcode}</p>'
									);
									t.overwrite('tplID', {	
										barcode: bcValue + ' not found.'
									});	
								} else {
									var fileName = data.data[0].filename;
									var mediumFileName = fileName.split(".");
									var path = data.data[0].path + mediumFileName[0]+'_l.'+mediumFileName[1];
									var barcode = data.data[0].barcode;
									var t = new Ext.Template(
											'<p align="center">Barcode: {barcode}</p>'
										,	'<p align="center"><img align="center" src={path}></p>'
									)
									t.overwrite('tplID', {
											path: path
										,	barcode: barcode	
									});	
								}
							}
						,	failure: function(result){
							}
						});
					}
				}

				if(e.keyCode == 8){
					var t = new Ext.Template(
						'<p>{barcode}</p>'
					);
					t.overwrite('tplID', {	
						barcode: ''
					});
				}

		}
		
		Ext.get('barcode').on('keypress', process);
		Ext.get('barcode').on('change', process);
		Ext.get('barcode').focus();
	});
  </script>
</body>
</html>
